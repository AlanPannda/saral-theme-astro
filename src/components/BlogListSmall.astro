---
import { SITE_BASE } from '@/consts'
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

type Props = {
	posts: Array<{
		slug: string
		data: {
			title: string
			pubDate: Date
			coverImageCredit?: string
		}
	}>
}

const { posts } = Astro.props

const blogImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/blogimages/**/*.{jpeg,jpg,png,gif}'
)
---

<div class="space-y-2">
	{
		posts.map((post) => (
			<a
				href={`${SITE_BASE}/blog/${post.slug}/`}
				class="flex gap-3 group hover:bg-gray-50 dark:hover:bg-gray-900/30 transition-colors -mx-3 px-3 py-2 rounded-lg"
			>
				{/* 左侧:图片 */}
				<div class="w-16 shrink-0">
					{(() => {
						const coverImagePath = `/src/assets/blogimages/${post.slug}/cover.jpg`
						const isCoverImagePath = post.data.coverImageCredit?.startsWith('/')
						const coverImageSrc =
							isCoverImagePath && post.data.coverImageCredit
								? `${SITE_BASE}${post.data.coverImageCredit}`
								: null

						return isCoverImagePath && coverImageSrc ? (
							<img
								src={coverImageSrc}
								alt={post.data.title}
								class="object-cover rounded-md aspect-square w-full h-full"
							/>
						) : (
							blogImages[coverImagePath] && (
								<Image
									src={blogImages[coverImagePath]()}
									alt={post.data.title}
									class="object-cover rounded-md aspect-square w-full h-full"
								/>
							)
						)
					})()}
				</div>

				{/* 右侧:信息 */}
				<div class="flex-1 flex flex-col justify-center min-w-0">
					<h3 class="font-semibold text-sm group-hover:text-primary dark:group-hover:text-primary-dark transition-colors line-clamp-2">
						{post.data.title}
					</h3>
					<p class="text-xs opacity-60 mt-1">
						{post.data.pubDate.toLocaleDateString('en-US', {
							year: 'numeric',
							month: 'short',
							day: 'numeric',
						})}
					</p>
				</div>
			</a>
		))
	}
</div>
